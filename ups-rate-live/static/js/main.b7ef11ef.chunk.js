(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{10:function(t,e,a){t.exports=a(20)},15:function(t,e,a){},17:function(t,e,a){},20:function(t,e,a){"use strict";a.r(e);var n=a(0),s=a.n(n),i=a(3),r=a.n(i),l=(a(15),a(7)),c=a(4),o=a(5),u=a(8),d=a(6),m=a(9),p=a(1),h=(a(17),function(t){function e(){var t;return Object(c.a)(this,e),(t=Object(u.a)(this,Object(d.a)(e).call(this))).state={fetchLimit:2,fetchCount:0,maxAge:3,subreddit:"politics",listings:[],posts:[],allTitles:[],displayTitles:"loading...",interval:6e4,pollRef:null},t.reqData=t.reqData.bind(Object(p.a)(Object(p.a)(t))),t.handleRes=t.handleRes.bind(Object(p.a)(Object(p.a)(t))),t.parseListings=t.parseListings.bind(Object(p.a)(Object(p.a)(t))),t.getListItems=t.getListItems.bind(Object(p.a)(Object(p.a)(t))),t.sortListItems=t.sortListItems.bind(Object(p.a)(Object(p.a)(t))),t.filterListItems=t.filterListItems.bind(Object(p.a)(Object(p.a)(t))),t.handleSubmit=t.handleSubmit.bind(Object(p.a)(Object(p.a)(t))),t.componentDidMount=t.componentDidMount.bind(Object(p.a)(Object(p.a)(t))),t}return Object(m.a)(e,t),Object(o.a)(e,[{key:"componentDidMount",value:function(){var t=this;this.reqData(),this.setState(function(e,a){return{pollRef:setInterval(function(){return t.reqData()},t.state.interval)}})}},{key:"reqData",value:function(t){var e,a,n=this;e=t||"https://old.reddit.com/r/".concat(this.state.subreddit,".json?limit=100"),a=new Request(e),fetch(a).then(function(t){return t.json()},function(t){console.log("fetch rejected:\n",t.toString()),n.setState(function(t,e){return{displayTitles:"error: invalid subreddit, fetch rejected by browser, or reddit is down."}})}).then(function(t){t?n.handleRes(t):console.log("falsy response:\n",t)}).catch(function(t){return console.log("fetch error:\n",t)})}},{key:"handleRes",value:function(t){var e=this;console.log("server response:\n",t),t.error?this.setState(function(e,a){return{displayTitles:"".concat(t.error,": ").concat(t.message)}}):this.setState(function(e,a){return{fetchCount:e.fetchCount+1,listings:Object(l.a)(e.listings).concat([t])}},function(){e.state.fetchCount<e.state.fetchLimit&&e.state.listings[+e.state.fetchCount-1].data.after?e.reqData("https://old.reddit.com/r/".concat(e.state.subreddit,".json?limit=100&after=").concat(e.state.listings[e.state.fetchCount-1].data.after)):e.setState(function(t,e){return{fetchCount:0}},function(){return e.parseListings()})})}},{key:"parseListings",value:function(){var t=this,e=this.state.posts,a=[];Object.values(this.state.listings).forEach(function(n){Object.values(n.data.children).forEach(function(n){Object.keys(t.state.posts).includes(n.data.id)?e[n.data.id].ups!==n.data.ups&&(e[n.data.id].ups=n.data.ups,e[n.data.id].score=n.data.score):a[n.data.id]={id:n.data.id,name:n.data.name,created:1e3*n.data.created_utc,title:n.data.title,author:n.data.author,subreddit:n.data.subreddit_name_prefixed,comments:n.data.permalink,ups:n.data.ups,score:n.data.score,domain:n.data.domain,url:n.data.url,thumb:"http"!==n.data.thumbnail.substring(0,4)?"https://via.placeholder.com/140x90/333/FFF/?text=".concat(n.data.thumbnail):n.data.thumbnail,thumbHeight:n.data.thumbnail_height,thumbWidth:n.data.thumbnail_width}})}),Object.keys(a).forEach(function(t){e[t]=a[t]}),this.setState(function(t,a){return{listings:[],posts:e}},function(){return t.getListItems()})}},{key:"getListItems",value:function(){var t=this,e=(new Date).getTime(),a=Object.values(this.state.posts).map(function(a){return s.a.createElement("li",{key:a.id},s.a.createElement("div",{className:"title"},s.a.createElement("a",{href:"https://reddit.com".concat(a.comments),target:"_blank",rel:"noopener noreferrer"},a.title)),s.a.createElement("div",{className:"details"},s.a.createElement("div",{className:"stats"},s.a.createElement("span",null,s.a.createElement("p",null,s.a.createElement("span",{className:"ups"},"ups"),": ",a.ups)),s.a.createElement("span",{className:"ages"},s.a.createElement("p",null,"age: ",Math.round((e-a.created)/36e5*100)/100)),s.a.createElement("span",{className:"avgs"},s.a.createElement("p",null,Math.round(Math.round(a.ups/(Math.round((e-a.created)/36e5*100)/100))/60*100)/100," ",s.a.createElement("span",{className:"ups"},"ups"),"/min"))),s.a.createElement("a",{href:a.url,target:"_blank",rel:"noopener noreferrer"},s.a.createElement("img",{src:a.thumb,alt:a.title}))),"all"===t.state.subreddit.substring(0,3)?s.a.createElement("div",{className:"source",style:{justifyContent:"space-between"}},s.a.createElement("small",null,a.subreddit),s.a.createElement("small",null,a.domain)):s.a.createElement("div",{className:"source",style:{justifyContent:"flex-end"}},s.a.createElement("small",null,a.domain)))});a=this.sortListItems(a),this.setState(function(t,e){return{allTitles:a,displayTitles:a}},function(){t.filterListItems()})}},{key:"sortListItems",value:function(t){return t.sort(function(t,e){return e.props.children[1].props.children[0].props.children[2].props.children.props.children[0]-t.props.children[1].props.children[0].props.children[2].props.children.props.children[0]})}},{key:"filterListItems",value:function(){var t=this,e=this.state.allTitles.filter(function(e){return e.props.children[1].props.children[0].props.children[1].props.children.props.children[1]<t.state.maxAge});this.setState(function(t,a){return{displayTitles:e}})}},{key:"handleSubmit",value:function(t){var e=this;if("click"===t.type){var a=document.getElementById("sub-input").value;a.length>0&&(clearInterval(this.state.pollRef),this.setState(function(t,e){return{subreddit:a,listings:[],posts:[],allTitles:[],displayTitles:"loading..."}},function(){e.reqData(),e.setState(function(t,a){return{pollRef:setInterval(function(){return e.reqData()},e.state.interval)}})}))}else if("input"===t.type){var n=+t.target.value;this.setState(function(t,e){return{maxAge:n}},function(){return e.filterListItems()})}}},{key:"render",value:function(){return s.a.createElement(s.a.Fragment,null,s.a.createElement("ul",null,s.a.createElement("li",null,s.a.createElement("div",{id:"control-header"},s.a.createElement("span",{className:"ups"},"ups")," rate ",s.a.createElement("span",{style:{color:"red"}},"live")),s.a.createElement("div",{id:"controls"},s.a.createElement("div",{id:"sub-controls"},s.a.createElement("p",{style:{flexShrink:"0"}},"subreddit: r/"),s.a.createElement("input",{style:{flexGrow:"0"},type:"text",id:"sub-input",placeholder:this.state.subreddit}),s.a.createElement("input",{style:{flexGrow:"0"},type:"submit",onClick:this.handleSubmit})),s.a.createElement("div",{id:"age-controls"},s.a.createElement("p",{style:{flexShrink:"0"}},"max age:"),s.a.createElement("select",{onInput:this.handleSubmit},s.a.createElement("option",{value:"3"},"3"),s.a.createElement("option",{value:"6"},"6"),s.a.createElement("option",{value:"12"},"12"),s.a.createElement("option",{value:"24"},"24"))))),this.state.displayTitles))}}]),e}(n.Component));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(s.a.createElement(h,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(t){t.unregister()})}},[[10,2,1]]]);
//# sourceMappingURL=main.b7ef11ef.chunk.js.map